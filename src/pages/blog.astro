---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { isBlogPostVisible } from '../lib/blog.js';

const allPosts = await getCollection('blog');
const posts = allPosts
  .filter((post) => isBlogPostVisible(post.id))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const categoryClasses = {
  'Web Development': 'bg-accent-purple/10 text-accent-purple',
  'AI & Automation': 'bg-accent-blue/10 text-accent-blue',
  'Business': 'bg-accent-pink/10 text-accent-pink',
  'Personal': 'bg-accent-purple/10 text-accent-purple',
};
const categoryHover = {
  'Web Development': 'group-hover:text-accent-purple',
  'AI & Automation': 'group-hover:text-accent-blue',
  'Business': 'group-hover:text-accent-pink',
  'Personal': 'group-hover:text-accent-purple',
};
---

<BaseLayout title="Blog - Randy Tarasevich">
  
  <section class="relative py-24 px-6 overflow-hidden">
    <div class="absolute top-20 left-1/3 w-[500px] h-[500px] glow-pink"></div>
    <div class="absolute bottom-0 right-1/4 w-[400px] h-[400px] glow-purple"></div>
    
    <div class="relative z-10 max-w-4xl mx-auto">
      <div class="mb-16">
        <h1 class="text-4xl md:text-5xl font-bold text-text-primary mb-4">Blog</h1>
        <p class="text-xl text-text-secondary">Thoughts on software development, entrepreneurship and education.</p>
      </div>
      
      <div class="space-y-8">
        
        {posts.map((post, i) => (
          <>
            {i > 0 && <div class="border-t border-border-subtle"></div>}
            <article class="group">
              <a href={`/blog/${post.id.replace(/\.md$/, '')}`} class="block p-6 -mx-6 rounded-xl hover:bg-bg-secondary/50 transition-colors">
                <div class="flex items-center gap-3 text-sm text-text-secondary mb-3">
                  <time datetime={post.data.pubDate.toISOString()}>
                    {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
                  </time>
                  <span>·</span>
                  <span>{post.data.readingTime ?? '—'} min read</span>
                  <span class={`px-2 py-0.5 rounded text-xs ${categoryClasses[post.data.category] ?? 'bg-bg-tertiary text-text-secondary'}`}>
                    {post.data.category}
                  </span>
                </div>
                <h2 class={`text-xl font-semibold text-text-primary mb-2 transition-colors ${categoryHover[post.data.category] ?? 'group-hover:text-accent-purple'}`}>
                  {post.data.title}
                </h2>
                <p class="text-text-secondary">{post.data.description}</p>
              </a>
            </article>
          </>
        ))}
        
      </div>
    </div>
  </section>

</BaseLayout>
